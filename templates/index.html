<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Price Prediction</title>
    <!-- React -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
    <!-- Recharts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.1.12/Recharts.min.js"></script>
    <!-- Babel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.22.20/babel.min.js"></script>
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        html, body {
            height: 100%;
            margin: 0;
        }

        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        #root {
            flex: 1;
        }

        a {
            text-decoration: none;
        }

        footer {
            flex-shrink: 0;
            width: 100%;
        }
    </style>
</head>

<body class="bg-gray-100">
    <a href="https://github.com/mohshbool/simple-stock-predictor" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></a>

    <div id="root"></div>
    {% raw %}
    <script type="text/babel">
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend } = Recharts;

        const StockPrediction = () => {
            const [formData, setFormData] = React.useState({
                ticker: 'AAPL',
                startDate: '2020-01-01',
                predictionDays: '60',
                daysToPredict: '7'
            });

            const [prediction, setPrediction] = React.useState(null);
            const [error, setError] = React.useState(null);
            const [loading, setLoading] = React.useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError(null);

                try {
                    const response = await fetch('/predict', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData),
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.error);
                    }

                    setPrediction(data);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({
                    ...prev,
                    [name]: value
                }));
            };

            // Prepare chart data
            const chartData = prediction ? [
                {
                    date: 'Current',
                    price: prediction.currentPrice
                },
                ...prediction.dates.map((date, index) => ({
                    date,
                    price: prediction.predictions[index]
                }))
            ] : [];

            return (
                <div className="max-w-4xl mx-auto p-6">
                    <h1 className="text-3xl font-bold mb-6">Stock Price Prediction</h1>

                    <form onSubmit={handleSubmit} className="space-y-4 mb-6">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-medium mb-1">Stock Symbol</label>
                                <input
                                    type="text"
                                    name="ticker"
                                    value={formData.ticker}
                                    onChange={handleInputChange}
                                    className="w-full p-2 border rounded"
                                    required
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium mb-1">Start Date</label>
                                <input
                                    type="date"
                                    name="startDate"
                                    value={formData.startDate}
                                    onChange={handleInputChange}
                                    className="w-full p-2 border rounded"
                                    required
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium mb-1">Training Window (days)</label>
                                <input
                                    type="number"
                                    name="predictionDays"
                                    value={formData.predictionDays}
                                    onChange={handleInputChange}
                                    className="w-full p-2 border rounded"
                                    min="1"
                                    required
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium mb-1">Days to Predict</label>
                                <input
                                    type="number"
                                    name="daysToPredict"
                                    value={formData.daysToPredict}
                                    onChange={handleInputChange}
                                    className="w-full p-2 border rounded"
                                    min="1"
                                    max="30"
                                    required
                                />
                            </div>
                        </div>

                        <button
                            type="submit"
                            disabled={loading}
                            className="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700 disabled:opacity-50"
                        >
                            {loading ? 'Predicting...' : 'Predict'}
                        </button>
                    </form>

                    {error && (
                        <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6">
                            <p className="font-bold">Error</p>
                            <p>{error}</p>
                        </div>
                    )}

                    {prediction && (
                        <div className="space-y-6">
                            <div className="bg-white p-4 rounded shadow">
                                <h3 className="text-lg font-semibold mb-2">Detailed Predictions</h3>
                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <p className="font-medium">Current Price</p>
                                        <p className="text-2xl">${prediction.currentPrice.toFixed(2)}</p>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white p-4 rounded shadow">
                                <h2 className="text-xl font-semibold mb-4">Prediction Results</h2>
                                <div className="w-full overflow-x-auto">
                                    <LineChart width={800} height={400} data={chartData} margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>
                                        <CartesianGrid strokeDasharray="3 3" />
                                        <XAxis dataKey="date" />
                                        <YAxis />
                                        <Tooltip />
                                        <Legend />
                                        <Line type="monotone" dataKey="price" stroke="#8884d8" />
                                    </LineChart>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<StockPrediction />, document.getElementById('root'));
    </script>
    {% endraw %}

    <footer style="width: 100%;">
        <div class="bg-gray-800 text-white text-center p-4">
            <p>&copy; 2024 <a href="https://www.shbool.net">Mohammad Shbool</a></p>
        </div>
    </footer>
</body>

</html>